<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Promesa: Llamada a API</title>
  <style>
    .exito {
      color: green;
    }
    .fracaso {
      color: red;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h3>Llamada del API</h3>
    <div class="w-25">
        <input class="form-control mb-3" type="text" id="numero" placeholder="Escribe un número" />
        <button class="btn btn-primary mb-3" id="llamarApi">Hacer llamada a API</button>
    </div>
    <div class="w-25" id="user-card">
        <div class="card-body mt-0">
            <p class="fs-6" id="resultado"></p>
            <h5 class="card-title fs-3" id="card-title"></h5>
            <h6 class="card-subtitle text-body-secondary mb-3" id="card-subtitle"></h6>
            <p class="card-text mb-0" id="card-text"></p>
            <p class="card-text" id="card-text-secondary"></p>
        </div>
    </div>
  </div>

  <script>
    const numberInput = document.getElementById('numero');
    const boton = document.getElementById('llamarApi');
    const resultado = document.getElementById('resultado');
   
    const card = document.getElementById('user-card');
    const cardTitle = document.getElementById('card-title');
    const cardSubtitle = document.getElementById('card-subtitle');
    const cardText = document.getElementById('card-text');
    const cardTextSec = document.getElementById('card-text-secondary');

    boton.addEventListener('click', () => {
        const numberValue = parseInt(numberInput.value.trim()); // Convertir el valor de input a número, con .trim() para eliminar espacios

        /* if (isNaN(numberValue) || numberValue > 10 || numberValue < 1) {
            alert('Por favor, introduce un número válido entre 1 y 10.');
            return; // Salir de la función si el número no es válido o es mayor que 10
        } */

        // Si el número es válido, hacemos la llamada a la API
        hacerLlamadaApi(numberValue)
            .then((data) => {
                // Mostrar resultado exitoso si la API devuelve datos
                mostrarResultado(`Éxito: Usuario encontrado`, true);
                actualizarCard(data, true);
            })
            .catch((error) => {
                // Mostrar mensaje de error si la llamada a la API falla
                mostrarResultado(`Fracaso: ${error.message}`, false);
                actualizarCard("", false);
            });
    });

    function hacerLlamadaApi(userId) {
        return new Promise((resolve, reject) => {
            // Usamos el ID introducido por el usuario para hacer la llamada a la API
            fetch(`https://jsonplaceholder.typicode.com/users/${userId}`)
                .then((response) => { //validar consulta
                  console.log(response);
                    if (response.ok) {
                        return response.json(); // Si la respuesta es exitosa, convertirla a JSON
                    } else {
                        reject(new Error('Usuario no encontrado.'));
                    }
                })
                .then((data) => resolve(data)) // Resolver la promesa con los datos obtenidos
                .catch(() => reject(new Error('No se pudo conectar con la API.'))); // Error en la conexión
        });
    }

    function mostrarResultado(mensaje, exito) {
        // Mostrar el mensaje de éxito o fracaso en el div "resultado"
        resultado.textContent = mensaje;
        resultado.className = exito ? 'exito' : 'fracaso';
    }

    function actualizarCard(data, exito) {
        if(exito){
            card.classList.add("card");

            // Actualizar el contenido del card con los datos de la API
            cardTitle.textContent = data.name;
            cardSubtitle.textContent = data.username;
            cardText.textContent = `Email: ${data.email}`;
            cardTextSec.textContent = `Ciudad: ${data.address.city}`;
        } else {
            card.classList.add("card");
            cardTitle.textContent = "";
            cardSubtitle.textContent = "";
            cardText.textContent = `Email: `;
            cardTextSec.textContent = `Ciudad: `;
        }
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>